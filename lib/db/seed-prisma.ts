import { PrismaClient } from '@prisma/client/edge'
import { withAccelerate } from '@prisma/extension-accelerate'
import { loadEnvFromFile } from '../env-loader'
import data from '../data'

// Load environment variables from .env file
loadEnvFromFile()

const prisma = new PrismaClient().$extends(withAccelerate())

async function main() {
  console.log('๐ฑ Starting Prisma seed...')

  // Clear existing data
  await prisma.orderItem.deleteMany()
  await prisma.orderShippingAddress.deleteMany()
  await prisma.order.deleteMany()
  await prisma.review.deleteMany()
  await prisma.userAddress.deleteMany()
  await prisma.user.deleteMany()
  await prisma.product.deleteMany()
  await prisma.category.deleteMany()
  await prisma.setting.deleteMany()
  await prisma.webPage.deleteMany()
  await prisma.fAQQuestion.deleteMany()
  await prisma.fAQCategory.deleteMany()

  console.log('๐๏ธ  Cleared existing data')

  // Create users
  const users = await Promise.all(
    data.users.map(async (userData) => {
      // Password is already hashed in data.ts, so use it directly
      return prisma.user.create({
        data: {
          phone: userData.phone,
          name: userData.name,
          role: userData.role,
          password: userData.password, // Already hashed in data.ts
          address: {
            create: {
              fullName: userData.address.fullName,
              street: userData.address.street,
              city: userData.address.city,
              province: userData.address.province,
              postalCode: userData.address.postalCode,
              country: userData.address.country,
              phone: userData.address.phone,
            }
          }
        },
        include: {
          address: true
        }
      })
    })
  )

  console.log(`๐ฅ Created ${users.length} users`)

  // Create categories
  const categories = await Promise.all(
    data.categories.map((categoryData) =>
      prisma.category.create({
        data: {
          name: categoryData.name,
          slug: categoryData.slug,
          description: categoryData.description,
          image: categoryData.image,
          isActive: categoryData.isActive,
        }
      })
    )
  )

  console.log(`๐ Created ${categories.length} categories`)

  // Create products
  const products = await Promise.all(
    data.products.map((productData) => {
      // Find the category by name to get the categoryId
      const category = categories.find(cat => cat.name === productData.category)
      
      return prisma.product.create({
        data: {
          name: productData.name,
          slug: productData.slug,
          categoryId: category?.id || null,
          category: productData.category,
          images: productData.images,
          brand: productData.brand,
          description: productData.description,
          productType: (productData as any).productType || 'game_code',
          price: productData.price,
          listPrice: productData.listPrice,
          countInStock: productData.countInStock,
          tags: productData.tags,
          colors: productData.colors,
          sizes: productData.sizes,
          avgRating: productData.avgRating,
          numReviews: productData.numReviews,
          ratingDistribution: productData.ratingDistribution as any,
          numSales: productData.numSales,
          isPublished: productData.isPublished,
        }
      })
    })
  )

  console.log(`๐ฆ Created ${products.length} products`)

  // Create orders
  const orders = await Promise.all(
    data.orders.map(async (orderData) => {
      // Find a real user ID to associate with the order
      const user = users[Math.floor(Math.random() * users.length)]
      
      // Create the order
      const order = await prisma.order.create({
        data: {
          userId: user.id,
          expectedDeliveryDate: orderData.expectedDeliveryDate,
          paymentMethod: orderData.paymentMethod,
          itemsPrice: orderData.itemsPrice,
          shippingPrice: orderData.shippingPrice,
          taxPrice: orderData.taxPrice,
          totalPrice: orderData.totalPrice,
          isPaid: orderData.isPaid,
          paidAt: orderData.paidAt,
          isDelivered: orderData.isDelivered,
          deliveredAt: orderData.deliveredAt,
        }
      })

      // Create order items
      const orderItems = await Promise.all(
        orderData.orderItems.map(async (itemData) => {
          // Find a real product ID to associate with the order item
          const product = products.find(p => p.name === itemData.name)
          if (!product) return null
          
          return prisma.orderItem.create({
            data: {
              orderId: order.id,
              productId: product.id,
              clientId: user.id, // Use user ID as client ID
              name: itemData.name,
              slug: product.slug,
              category: itemData.category,
              quantity: itemData.quantity,
              countInStock: product.countInStock,
              image: itemData.image,
              price: itemData.price,
            }
          })
        })
      )

      // Create shipping address for the order
      if (orderData.shippingAddress) {
        await prisma.orderShippingAddress.create({
          data: {
            orderId: order.id,
            street: orderData.shippingAddress.street,
            province: orderData.shippingAddress.province,
            area: orderData.shippingAddress.area,
            apartment: orderData.shippingAddress.apartment,
            building: orderData.shippingAddress.building,
            floor: orderData.shippingAddress.floor,
            landmark: orderData.shippingAddress.landmark,
          }
        })
      }

      return order
    })
  )

  console.log(`๐ Created ${orders.length} orders`)

  // Create settings
  const settings = await Promise.all(
    data.settings.map((settingData) =>
      prisma.setting.create({
        data: {
          common: settingData.common as any,
          site: settingData.site as any,
          carousels: settingData.carousels as any,
          availableLanguages: settingData.availableLanguages as any,
          defaultLanguage: settingData.defaultLanguage,
          availableCurrencies: settingData.availableCurrencies as any,
          defaultCurrency: settingData.defaultCurrency,
          availablePaymentMethods: settingData.availablePaymentMethods as any,
          defaultPaymentMethod: settingData.defaultPaymentMethod,
          availableDeliveryDates: settingData.availableDeliveryDates as any,
          defaultDeliveryDate: settingData.defaultDeliveryDate,
        }
      })
    )
  )

  console.log(`โ๏ธ  Created ${settings.length} settings`)

  // Create web pages
  const webPages = await Promise.all(
    data.webPages.map((webPageData) =>
      prisma.webPage.create({
        data: {
          title: webPageData.title,
          slug: webPageData.slug,
          content: webPageData.content,
          isPublished: webPageData.isPublished,
        }
      })
    )
  )

  console.log(`๐ Created ${webPages.length} web pages`)

  // Create FAQ data
  const faqCategories = await Promise.all([
    prisma.fAQCategory.create({
      data: {
        title: 'ุงูุทูุจุงุช ูุงูุชูุตูู',
        slug: 'orders-delivery',
        sortOrder: 1,
        isActive: true,
        questions: {
          create: [
            {
              question: 'ููู ุฃุชุฃูุฏ ูู ุงุณุชูุงู ุทูุจูุ',
              answer: 'ุณุชุชููู ุฑุณุงูุฉ ุชุฃููุฏ ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููุฑ ุฅุชูุงู ุทูุจูุ ุจุงูุฅุถุงูุฉ ุฅูู ุฑูู ุชุชุจุน ููููู ุงุณุชุฎุฏุงูู ููุชุงุจุนุฉ ุญุงูุฉ ุงูุทูุจ. ููููู ุฃูุถุงู ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุญุณุงุจู ูุฒูุงุฑุฉ ุตูุญุฉ "ุทูุจุงุชู" ููุนุฑูุฉ ุญุงูุฉ ุทูุจู.',
              sortOrder: 1,
              isActive: true
            },
            {
              question: 'ูุง ูู ุทุฑู ุงูุฏูุน ุงููุชุงุญุฉุ',
              answer: 'ููุจู ุงูุฏูุน ููุฏุงู ุนูุฏ ุงูุงุณุชูุงูุ ููุฏุงููู ูุงุดุ ุฅูุณุชุง ุจุงูุ ูุจุทุงูุงุช ุงูุงุฆุชูุงู. ุฌููุน ุทุฑู ุงูุฏูุน ุขููุฉ ููุญููุฉ.',
              sortOrder: 2,
              isActive: true
            },
            {
              question: 'ูุง ูู ูุฏุฉ ุงูุชูุตูู ุงููุชููุนุฉุ',
              answer: 'ูููุฑ ุชูุตูู ุณุฑูุน ุฎูุงู 4 ุณุงุนุงุช ููุชูุตูู ุงูููุฑูุ ุฃู ุฎูุงู 5 ุฃูุงู ุนูู ููุชูุตูู ุงูููุงุณู. ูุฏ ุชุฎุชูู ุงููุฏุฉ ุญุณุจ ุงูููุทูุฉ.',
              sortOrder: 3,
              isActive: true
            },
            {
              question: 'ูู ููุงู ุฑุณูู ุชูุตููุ',
              answer: 'ูุนูุ ุฑุณูู ุงูุชูุตูู 4.99 ุฌูููุ ููู ุงูุชูุตูู ูุฌุงูู ููุทูุจุงุช ุงูุชู ุชุฒูุฏ ุนู 50 ุฌููู.',
              sortOrder: 4,
              isActive: true
            }
          ]
        }
      }
    }),
    prisma.fAQCategory.create({
      data: {
        title: 'ุงูููุชุฌุงุช',
        slug: 'products',
        sortOrder: 2,
        isActive: true,
        questions: {
          create: [
            {
              question: 'ูู ููุชุฌุงุชูู ุฃุตููุฉ ููุฑุฎุตุฉุ',
              answer: 'ูุนูุ ุฌููุน ููุชุฌุงุชูุง ุฃุตููุฉ 100% ููุถูููุฉ ูู Xbox. ูุญู ูุชุฌุฑ ูุนุชูุฏ ูุถูู ุฌูุฏุฉ ุฌููุน ุงูููุชุฌุงุช.',
              sortOrder: 1,
              isActive: true
            },
            {
              question: 'ูู ูููููู ุฅุฑุฌุงุน ุฃู ุงุณุชุจุฏุงู ุงูููุชุฌุ',
              answer: 'ููููู ุฅุฑุฌุงุน ุฃู ุงุณุชุจุฏุงู ุงูููุชุฌ ุฎูุงู 7 ุฃูุงู ูู ุชุงุฑูุฎ ุงูุงุณุชูุงู ุฅุฐุง ูุงู ูู ุญุงูุฉ ุฌูุฏุฉ ูุบูุฑ ูุณุชุฎุฏู.',
              sortOrder: 2,
              isActive: true
            },
            {
              question: 'ููู ุฃุชุฃูุฏ ูู ุชููุฑ ุงูููุชุฌุ',
              answer: 'ููููู ุงูุงุทูุงุน ุนูู ุญุงูุฉ ุงูุชููุฑ ุนูู ุตูุญุฉ ุงูููุชุฌ. ุฅุฐุง ูุงู ุงูููุชุฌ ุบูุฑ ูุชููุฑุ ููููู ุชุณุฌูู ุจุฑูุฏู ุงูุฅููุชุฑููู ููุชู ุฅุดุนุงุฑู ุนูุฏ ุนูุฏุฉ ุงูุชููุฑ.',
              sortOrder: 3,
              isActive: true
            }
          ]
        }
      }
    }),
    prisma.fAQCategory.create({
      data: {
        title: 'Xbox Game Pass',
        slug: 'xbox-game-pass',
        sortOrder: 3,
        isActive: true,
        questions: {
          create: [
            {
              question: 'ูุง ูู ุงูุงุดุชุฑุงูุงุช ุงููุชุงุญุฉุ',
              answer: 'ูููุฑ ุงุดุชุฑุงูุงุช Xbox Game Pass Ultimate ูู ุฎุทุท 1 ุดูุฑุ 3 ุฃุดูุฑุ 6 ุฃุดูุฑุ ู12 ุดูุฑ.',
              sortOrder: 1,
              isActive: true
            },
            {
              question: 'ูู ูููููู ุฅูุบุงุก ุงูุงุดุชุฑุงูุ',
              answer: 'ูุนูุ ููููู ุฅูุบุงุก ุงูุงุดุชุฑุงู ูู ุฃู ููุช. ูู ูุชู ุฎุตู ุฃู ุฑุณูู ุฅุถุงููุฉ ููู ุจุนุฏ ูุชุฑุฉ ุงูุงุดุชุฑุงู ุงููุฏููุนุฉ.',
              sortOrder: 2,
              isActive: true
            },
            {
              question: 'ููู ุฃุณุชุฎุฏู ุจุทุงูุฉ ุงุดุชุฑุงู Game Passุ',
              answer: 'ุจุนุฏ ุงูุดุฑุงุกุ ุณุชุญุตู ุนูู ููุฏ ุฅููุชุฑููู ููููู ุงุณุชุฎุฏุงูู ูุชูุดูุท ุงูุงุดุชุฑุงู ูุจุงุดุฑุฉ ุนูู ุฌูุงุฒ Xbox ุฃู ูู ุฎูุงู ูููุน Xbox.',
              sortOrder: 3,
              isActive: true
            }
          ]
        }
      }
    }),
    prisma.fAQCategory.create({
      data: {
        title: 'ุงููุญูุธุฉ ุงูุฑูููุฉ ูุงูุจุทุงูุงุช',
        slug: 'digital-wallet',
        sortOrder: 4,
        isActive: true,
        questions: {
          create: [
            {
              question: 'ูุง ูู ุจุทุงูุงุช ุงููุฏุงูุง ุงููุชุงุญุฉุ',
              answer: 'ูููุฑ ุจุทุงูุงุช ูุฏุงูุง Xbox Live Goldุ Xbox Game Passุ ูุจุทุงูุงุช ูุฏุงูุง Microsoft Store ุจุฑูุญูุฉ 10ุ 25ุ 50ุ 100 ุฏููุงุฑ.',
              sortOrder: 1,
              isActive: true
            },
            {
              question: 'ูู ูุณุชุบุฑู ุงููุตูู ููุจุทุงูุฉ ุงูุฑูููุฉุ',
              answer: 'ุนุงุฏุฉ ูุง ูุณุชุบุฑู ุงูุฃูุฑ ูู 5 ุฅูู 15 ุฏูููุฉ. ุณูุชู ุฅุฑุณุงู ุงูููุฏ ุฅูู ุจุฑูุฏู ุงูุฅููุชุฑููู ููุฑ ุชุฃููุฏ ุงูุฏูุน.',
              sortOrder: 2,
              isActive: true
            },
            {
              question: 'ูู ูููููู ุฅุฑุฌุงุน ุงูุจุทุงูุงุช ุงูุฑูููุฉุ',
              answer: 'ูุง ูููู ุฅุฑุฌุงุน ุฃู ุงุณุชุจุฏุงู ุงูุจุทุงูุงุช ุงูุฑูููุฉ ุจุนุฏ ุงูุดุฑุงุก ูุฃุณุจุงุจ ุฃูููุฉ. ูุฑุฌู ุงูุชุฃูุฏ ูู ุงุฎุชูุงุฑ ุงูุจุทุงูุฉ ุงูุตุญูุญุฉ ูุจู ุงูุดุฑุงุก.',
              sortOrder: 3,
              isActive: true
            }
          ]
        }
      }
    }),
    prisma.fAQCategory.create({
      data: {
        title: 'ุงูุญุณุงุจ ูุงูููู ุงูุดุฎุตู',
        slug: 'account',
        sortOrder: 5,
        isActive: true,
        questions: {
          create: [
            {
              question: 'ููู ุฃุนุฑู ุญุงูุฉ ุทูุจูุ',
              answer: 'ููููู ูุชุงุจุนุฉ ุญุงูุฉ ุทูุจู ูู ุฎูุงู ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุญุณุงุจู ูุฒูุงุฑุฉ ุตูุญุฉ "ุทูุจุงุชู".',
              sortOrder: 1,
              isActive: true
            },
            {
              question: 'ููู ุฃุบูุฑ ุจูุงูุงุชู ุงูุดุฎุตูุฉุ',
              answer: 'ูู ุจุชุณุฌูู ุงูุฏุฎูู ุฅูู ุญุณุงุจู ูุงุถุบุท ุนูู "ุญุณุงุจู" ูุชุนุฏูู ูุนูููุงุชู ุงูุดุฎุตูุฉ.',
              sortOrder: 2,
              isActive: true
            },
            {
              question: 'ูุงุฐุง ุฃูุนู ุฅุฐุง ูุณูุช ูููุฉ ุงููุฑูุฑุ',
              answer: 'ุงููุฑ ุนูู "ูุณูุช ูููุฉ ุงููุฑูุฑ" ูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู ูุงุชุจุน ุงูุชุนูููุงุช ูุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ.',
              sortOrder: 3,
              isActive: true
            }
          ]
        }
      }
    }),
    prisma.fAQCategory.create({
      data: {
        title: 'ุงูุฏุนู ูุงููุณุงุนุฏุฉ',
        slug: 'support',
        sortOrder: 6,
        isActive: true,
        questions: {
          create: [
            {
              question: 'ููู ุฃุชูุงุตู ูุน ุฎุฏูุฉ ุงูุนููุงุกุ',
              answer: 'ููููู ุงูุชูุงุตู ูุนูุง ุนุจุฑ ุงููุงุชู: +20 123 456 7890ุ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: support@xbox-store.comุ ุฃู ูุงุชุณุงุจ ุงููุชุงุญ ุนูู ุงููููุน 24/7.',
              sortOrder: 1,
              isActive: true
            },
            {
              question: 'ูู ุชููุฑูู ุฏุนู ูููุ',
              answer: 'ูุนูุ ูุฑูููุง ุงูููู ุฌุงูุฒ ููุณุงุนุฏุชู ูู ุญู ุฃู ูุดุงูู ุชูููุฉ ูุฏ ุชูุงุฌูู ูุน ุงูููุชุฌุงุช ุฃู ุงูุฎุฏูุงุช.',
              sortOrder: 2,
              isActive: true
            }
          ]
        }
      }
    }),
    prisma.fAQCategory.create({
      data: {
        title: 'ุงูุฃูุงู ูุงูุฎุตูุตูุฉ',
        slug: 'security',
        sortOrder: 7,
        isActive: true,
        questions: {
          create: [
            {
              question: 'ูู ุจูุงูุงุชู ุขููุฉุ',
              answer: 'ูุนูุ ูุณุชุฎุฏู ุฃุญุฏุซ ุฃูุธูุฉ ุงูุญูุงูุฉ ูุงูุชุดููุฑ ูุถูุงู ุฃูุงู ุจูุงูุงุชู ุงูุดุฎุตูุฉ ูุงููุนูููุงุช ุงููุตุฑููุฉ.',
              sortOrder: 1,
              isActive: true
            },
            {
              question: 'ูู ุชุดุงุฑููู ุจูุงูุงุชู ูุน ุฌูุงุช ุฃุฎุฑูุ',
              answer: 'ูุงุ ูุญู ูุง ูุดุงุฑู ุจูุงูุงุชู ูุน ุฃู ุทุฑู ุซุงูุซ. ุฌููุน ูุนูููุงุชู ูุญููุธุฉ ุจุดูู ุขูู ูุณุฑู.',
              sortOrder: 2,
              isActive: true
            }
          ]
        }
      }
    }),
    prisma.fAQCategory.create({
      data: {
        title: 'ุงูุจุฑุงูุฌ ูุงูุนุฑูุถ',
        slug: 'offers',
        sortOrder: 8,
        isActive: true,
        questions: {
          create: [
            {
              question: 'ูู ูุฏููู ุนุฑูุถ ุฎุงุตุฉุ',
              answer: 'ูุนูุ ููุฏู ุนุฑูุถ ุฏูุฑูุฉ ูุฎุตููุงุช ุญุตุฑูุฉ. ูู ุจูุชุงุจุนุฉ ุญุณุงุจุงุชูุง ุนูู ูุณุงุฆู ุงูุชูุงุตู ุงูุงุฌุชูุงุนู ููุงุทูุงุน ุนูู ุฃุญุฏุซ ุงูุนุฑูุถ.',
              sortOrder: 1,
              isActive: true
            },
            {
              question: 'ููู ุฃุญุตู ุนูู ููุฏ ุฎุตูุ',
              answer: 'ููููู ุงูุญุตูู ุนูู ููุฏ ุฎุตู ูู ุฎูุงู ุงูุงุดุชุฑุงู ูู ุงููุดุฑุฉ ุงูุฅุฎุจุงุฑูุฉ ุฃู ูุชุงุจุนุฉ ุนุฑูุถูุง ุงูุฎุงุตุฉ ุนูู ุงููููุน.',
              sortOrder: 2,
              isActive: true
            }
          ]
        }
      }
    })
  ])

  console.log(`โ Created ${faqCategories.length} FAQ categories`)

  console.log('โ Prisma seed completed successfully!')
}

main()
  .catch((e) => {
    console.error('โ Prisma seed failed:', e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
